<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Missing You - Chaos of Doubt</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            height: 100vh;
            background: linear-gradient(45deg, #1a0000, #8b0000, #2d0000, #dc143c);
            background-size: 400% 400%;
            animation: chaosBackground 8s ease-in-out infinite;
            overflow: hidden;
            font-family: 'Georgia', serif;
            position: relative;
        }

        @keyframes chaosBackground {
            0%, 100% { background-position: 0% 50%; }
            25% { background-position: 100% 0%; }
            50% { background-position: 100% 100%; }
            75% { background-position: 0% 100%; }
        }

        .chaos-container {
            position: relative;
            width: 100%;
            height: 100vh;
            overflow: hidden;
        }

        .broken-heart {
            position: absolute;
            font-size: 8rem;
            color: #ff1744;
            z-index: 10;
            animation: heartbreak 3s ease-in-out infinite;
            filter: drop-shadow(0 0 30px rgba(255, 23, 68, 0.8));
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .broken-heart:hover {
            transform: scale(1.2);
            filter: drop-shadow(0 0 50px rgba(255, 23, 68, 1));
        }

        .main-heart {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 12rem;
        }

        .main-heart.playing {
            animation: heartbeat 0.8s ease-in-out infinite;
            color: #ff0040;
            filter: drop-shadow(0 0 50px rgba(255, 0, 64, 1));
        }

        @keyframes heartbeat {
            0%, 100% { 
                transform: translate(-50%, -50%) scale(1);
            }
            50% { 
                transform: translate(-50%, -50%) scale(1.15);
            }
        }

        @keyframes heartbreak {
            0%, 100% { 
                transform: translate(-50%, -50%) rotate(0deg) scale(1);
                opacity: 1;
            }
            25% { 
                transform: translate(-50%, -50%) rotate(-5deg) scale(1.1);
                opacity: 0.8;
            }
            50% { 
                transform: translate(-50%, -50%) rotate(5deg) scale(0.9);
                opacity: 1;
            }
            75% { 
                transform: translate(-50%, -50%) rotate(-3deg) scale(1.05);
                opacity: 0.9;
            }
        }

        .floating-heart {
            position: absolute;
            font-size: 3rem;
            animation: floatChaos 6s ease-in-out infinite;
            pointer-events: none;
        }

        @keyframes floatChaos {
            0%, 100% { 
                transform: translateY(0) rotate(0deg) scale(1);
                opacity: 0.7;
            }
            25% { 
                transform: translateY(-30px) rotate(45deg) scale(1.2);
                opacity: 1;
            }
            50% { 
                transform: translateY(-10px) rotate(-30deg) scale(0.8);
                opacity: 0.9;
            }
            75% { 
                transform: translateY(-40px) rotate(60deg) scale(1.1);
                opacity: 0.8;
            }
        }

        .chaos-text {
            position: absolute;
            color: rgba(255, 255, 255, 0.9);
            font-size: 1.5rem;
            font-weight: bold;
            text-shadow: 2px 2px 10px rgba(0,0,0,0.7);
            animation: chaosFloat 4s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 5;
        }

        .chaos-text:hover {
            color: #ff1744;
            transform: scale(1.1);
            text-shadow: 0 0 20px rgba(255, 23, 68, 0.8);
        }

        @keyframes chaosFloat {
            0%, 100% { 
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }
            50% { 
                transform: translateY(-20px) rotate(2deg);
                opacity: 1;
            }
        }

        .image-frame {
            position: absolute;
            width: 150px;
            height: 120px;
            border: 3px solid rgba(255, 23, 68, 0.8);
            border-radius: 15px;
            background: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            color: rgba(255, 255, 255, 0.7);
            font-size: 0.9rem;
            text-align: center;
            animation: frameFloat 5s ease-in-out infinite;
            cursor: pointer;
            transition: all 0.3s ease;
            backdrop-filter: blur(5px);
            overflow: hidden;
        }

        .image-frame:hover {
            border-color: #ff1744;
            background: rgba(255, 23, 68, 0.1);
            transform: scale(1.05);
            box-shadow: 0 0 30px rgba(255, 23, 68, 0.5);
        }

        .image-frame img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            border-radius: 12px;
        }

        .image-frame .placeholder {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            text-align: center;
        }

        .image-frame.has-image .placeholder {
            display: none;
        }

        @keyframes frameFloat {
            0%, 100% { 
                transform: translateY(0) rotate(0deg);
                opacity: 0.8;
            }
            33% { 
                transform: translateY(-15px) rotate(1deg);
                opacity: 1;
            }
            66% { 
                transform: translateY(-5px) rotate(-1deg);
                opacity: 0.9;
            }
        }

        .tear {
            position: absolute;
            color: #87ceeb;
            font-size: 2rem;
            animation: tearFall 3s linear infinite;
            pointer-events: none;
            z-index: 2;
        }

        @keyframes tearFall {
            0% {
                transform: translateY(-20px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0;
            }
        }

        .music-chaos {
            position: absolute;
            background: rgba(139, 0, 0, 0.8);
            border: 2px solid #ff1744;
            border-radius: 50%;
            width: 80px;
            height: 80px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            cursor: pointer;
            animation: musicSpin 4s linear infinite;
            transition: all 0.3s ease;
            backdrop-filter: blur(10px);
        }

        .music-chaos:hover {
            background: rgba(255, 23, 68, 0.9);
            transform: scale(1.2);
            box-shadow: 0 0 30px rgba(255, 23, 68, 0.7);
        }

        .music-chaos.playing {
            background: rgba(255, 23, 68, 1);
            box-shadow: 0 0 40px rgba(255, 23, 68, 0.9);
            animation: musicSpin 1s linear infinite;
        }

        @keyframes musicSpin {
            0% { transform: rotate(0deg) scale(1); }
            25% { transform: rotate(90deg) scale(1.1); }
            50% { transform: rotate(180deg) scale(0.9); }
            75% { transform: rotate(270deg) scale(1.05); }
            100% { transform: rotate(360deg) scale(1); }
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255, 23, 68, 0.8);
            color: white;
            border: none;
            padding: 15px 25px;
            border-radius: 25px;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 20;
            backdrop-filter: blur(10px);
        }

        .back-button:hover {
            background: rgba(255, 23, 68, 1);
            transform: scale(1.05);
            box-shadow: 0 0 20px rgba(255, 23, 68, 0.5);
        }

        .message-icon {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(255, 23, 68, 0.8);
            color: white;
            border: none;
            padding: 15px;
            border-radius: 50%;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 20;
            backdrop-filter: blur(10px);
            width: 60px;
            height: 60px;
            display: flex;
            align-items: center;
            justify-content: center;
            animation: messageGlow 2s ease-in-out infinite;
        }

        .message-icon:hover {
            background: rgba(255, 23, 68, 1);
            transform: scale(1.1);
            box-shadow: 0 0 30px rgba(255, 23, 68, 0.7);
        }

        @keyframes messageGlow {
            0%, 100% { 
                box-shadow: 0 0 20px rgba(255, 23, 68, 0.5);
            }
            50% { 
                box-shadow: 0 0 40px rgba(255, 23, 68, 0.9);
            }
        }

        .message-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.9);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            backdrop-filter: blur(10px);
            padding: 20px;
        }

        .message-content {
            background: linear-gradient(135deg, #1a0000, #8b0000);
            border: 3px solid #ff1744;
            border-radius: 20px;
            max-width: 600px;
            width: 100%;
            max-height: 80vh;
            position: relative;
            animation: messageAppear 0.5s ease-out;
            display: flex;
            flex-direction: column;
            overflow: hidden;
        }

        @keyframes messageAppear {
            0% {
                transform: scale(0.3) rotate(10deg);
                opacity: 0;
            }
            100% {
                transform: scale(1) rotate(0deg);
                opacity: 1;
            }
        }

        .message-header {
            padding: 30px 40px 0 40px;
            text-align: center;
            flex-shrink: 0;
        }

        .message-header h2 {
            color: #ff1744;
            font-size: 2rem;
            margin-bottom: 20px;
            text-shadow: 0 0 20px rgba(255, 23, 68, 0.5);
        }

        .message-body {
            padding: 0 40px 40px 40px;
            overflow-y: auto;
            flex: 1;
            scrollbar-width: thin;
            scrollbar-color: #ff1744 rgba(139, 0, 0, 0.3);
        }

        .message-body::-webkit-scrollbar {
            width: 8px;
        }

        .message-body::-webkit-scrollbar-track {
            background: rgba(139, 0, 0, 0.3);
            border-radius: 10px;
        }

        .message-body::-webkit-scrollbar-thumb {
            background: #ff1744;
            border-radius: 10px;
            box-shadow: 0 0 10px rgba(255, 23, 68, 0.5);
        }

        .message-body::-webkit-scrollbar-thumb:hover {
            background: #ff0040;
            box-shadow: 0 0 15px rgba(255, 23, 68, 0.8);
        }

        .message-body p {
            color: white;
            font-size: 1.2rem;
            line-height: 1.6;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            margin-bottom: 20px;
        }

        .message-body p:last-child {
            margin-bottom: 0;
        }

        .close-message {
            position: absolute;
            top: 15px;
            right: 20px;
            background: none;
            border: none;
            color: #ff1744;
            font-size: 2rem;
            cursor: pointer;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .close-message:hover {
            color: white;
            transform: scale(1.2);
        }

        .file-input {
            display: none;
        }

        .glitch {
            animation: glitch 2s ease-in-out infinite;
        }

        @keyframes glitch {
            0%, 100% { 
                transform: translate(0);
                filter: hue-rotate(0deg);
            }
            10% { 
                transform: translate(-2px, 2px);
                filter: hue-rotate(90deg);
            }
            20% { 
                transform: translate(-2px, -2px);
                filter: hue-rotate(180deg);
            }
            30% { 
                transform: translate(2px, 2px);
                filter: hue-rotate(270deg);
            }
            40% { 
                transform: translate(2px, -2px);
                filter: hue-rotate(360deg);
            }
        }

        .audio-status {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: rgba(0, 0, 0, 0.8);
            color: white;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 1rem;
            z-index: 20;
            backdrop-filter: blur(10px);
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .audio-status.show {
            opacity: 1;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .broken-heart {
                font-size: 6rem;
            }
            .main-heart {
                font-size: 8rem;
            }
            .chaos-text {
                font-size: 1.2rem;
            }
            .image-frame {
                width: 120px;
                height: 90px;
                font-size: 0.8rem;
            }
            .music-chaos {
                width: 60px;
                height: 60px;
                font-size: 1.5rem;
            }
            .message-content {
                max-height: 85vh;
                margin: 10px;
            }
            .message-header {
                padding: 20px 20px 0 20px;
            }
            .message-header h2 {
                font-size: 1.5rem;
            }
            .message-body {
                padding: 0 20px 20px 20px;
            }
            .message-body p {
                font-size: 1rem;
            }
        }

        @media (max-width: 480px) {
            .message-modal {
                padding: 10px;
            }
            .message-content {
                max-height: 90vh;
            }
            .message-header {
                padding: 15px 15px 0 15px;
            }
            .message-header h2 {
                font-size: 1.3rem;
            }
            .message-body {
                padding: 0 15px 15px 15px;
            }
            .message-body p {
                font-size: 0.95rem;
                line-height: 1.5;
            }
        }
    </style>
</head>
<body>
    <!-- Audio elements -->
    <audio id="mainHeartAudio" preload="auto">
        <source src="/assets/audio/PARTYNEXTDOOR - You ve Been Missed [Official Audio].mp3" type="audio/wav">
    </audio>

    <audio id="musicAudio1" preload="auto">
        <source src="/assets/audio/PARTYNEXTDOOR - TRAUMA (Official Audio).mp3" type="audio/wav">
    </audio>

    <audio id="musicAudio2" preload="auto">
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
    </audio>

    <audio id="musicAudio3" preload="auto">
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
    </audio>

    <audio id="musicAudio4" preload="auto">
        <source src="https://www.soundjay.com/misc/sounds/bell-ringing-05.wav" type="audio/wav">
    </audio>

    <!-- Hidden file inputs for photo uploads -->
    <input type="file" id="fileInput1" class="file-input" accept="image/*" onchange="handleImageUpload(1, this)">
    <input type="file" id="fileInput2" class="file-input" accept="image/*" onchange="handleImageUpload(2, this)">
    <input type="file" id="fileInput3" class="file-input" accept="image/*" onchange="handleImageUpload(3, this)">
    <input type="file" id="fileInput4" class="file-input" accept="image/*" onchange="handleImageUpload(4, this)">
    <input type="file" id="fileInput5" class="file-input" accept="image/*" onchange="handleImageUpload(5, this)">

    <div class="chaos-container">
        <button class="back-button" onclick="goBack()">‚Üê Back to Choice</button>
        <button class="message-icon" onclick="showMessage()">üíå</button>
        
        <!-- Main broken heart -->
        <div class="broken-heart main-heart" onclick="playMainMusic()" id="mainHeart">üíî</div>
        
        <!-- Floating broken hearts -->
        <div class="floating-heart" style="top: 10%; left: 20%; animation-delay: -1s;">üñ§</div>
        <div class="floating-heart" style="top: 80%; left: 80%; animation-delay: -3s;">üíî</div>
        <div class="floating-heart" style="top: 30%; left: 90%; animation-delay: -5s;">ü•Ä</div>
        <div class="floating-heart" style="top: 70%; left: 10%; animation-delay: -2s;">‚ö´</div>
        <div class="floating-heart" style="top: 15%; left: 70%; animation-delay: -4s;">üñ§</div>
        
        <!-- Chaotic text messages -->
        <div class="chaos-text glitch" style="top: 15%; left: 15%; animation-delay: -1s;">
            "I miss your laugh..."
        </div>
        <div class="chaos-text" style="top: 25%; right: 10%; animation-delay: -2s;">
            "Empty without you"
        </div>
        <div class="chaos-text glitch" style="bottom: 20%; left: 25%; animation-delay: -3s;">
            "What if you say no?"
        </div>
        <div class="chaos-text" style="top: 40%; left: 5%; animation-delay: -4s;">
            "Lost in thoughts of you"
        </div>
        <div class="chaos-text glitch" style="bottom: 40%; right: 20%; animation-delay: -5s;">
            "My heart aches..."
        </div>
        <div class="chaos-text" style="top: 60%; right: 15%; animation-delay: -6s;">
            "Dreaming of your smile"
        </div>
        
        <!-- Image frames with your pre-uploaded photos -->
        <div class="image-frame" style="top: 5%; right: 25%; animation-delay: -1s;" id="imageFrame1">
            <img src="assets/images/memory1.jpg" alt="Memory of us" onerror="showPlaceholder(1)">
            <div class="placeholder" style="display: none;">
                üì∏<br>Memory of you<br>Add photo as:<br>assets/images/memory1.jpg
            </div>
        </div>
        <div class="image-frame" style="bottom: 15%; left: 40%; animation-delay: -3s;" id="imageFrame2">
            <img src="assets/images/memory2.jpg" alt="Our special moment" onerror="showPlaceholder(2)">
            <div class="placeholder" style="display: none;">
                üì∑<br>Our moment<br>Add photo as:<br>assets/images/memory2.jpg
            </div>
        </div>
        <div class="image-frame" style="top: 45%; right: 5%; animation-delay: -2s;" id="imageFrame3">
            <img src="assets/images/memory3.jpg" alt="Missing this" onerror="showPlaceholder(3)">
            <div class="placeholder" style="display: none;">
                üñºÔ∏è<br>Missing this<br>Add photo as:<br>assets/images/memory3.jpg
            </div>
        </div>
        <div class="image-frame" style="bottom: 45%; right: 40%; animation-delay: -4s;" id="imageFrame4">
            <img src="assets/images/memory4.jpg" alt="Your beauty" onerror="showPlaceholder(4)">
            <div class="placeholder" style="display: none;">
                üì∏<br>Your beauty<br>Add photo as:<br>assets/images/memory4.jpg
            </div>
        </div>
        <div class="image-frame" style="top: 35%; left: 25%; animation-delay: -5s;" id="imageFrame5">
            <img src="assets/images/memory5.jpg" alt="Lonely times" onerror="showPlaceholder(5)">
            <div class="placeholder" style="display: none;">
                üì∑<br>Lonely times<br>Add photo as:<br>assets/images/memory5.jpg
            </div>
        </div>
        
        <!-- Music chaos buttons -->
        <div class="music-chaos" style="top: 20%; left: 45%; animation-delay: -1s;" onclick="playMusic(1)" id="musicBtn1">üéµ</div>
        <div class="music-chaos" style="bottom: 25%; left: 15%; animation-delay: -2s;" onclick="playMusic(2)" id="musicBtn2">üé∂</div>
        <div class="music-chaos" style="top: 65%; left: 60%; animation-delay: -3s;" onclick="playMusic(3)" id="musicBtn3">üéº</div>
        <div class="music-chaos" style="bottom: 10%; right: 30%; animation-delay: -4s;" onclick="playMusic(4)" id="musicBtn4">üéß</div>
        
        <div class="audio-status" id="audioStatus">üéµ Now Playing...</div>
    </div>

    <!-- Message Modal -->
    <div class="message-modal" id="messageModal">
        <div class="message-content">
            <button class="close-message" onclick="hideMessage()">&times;</button>
            <div class="message-header">
                <h2>üíî From My Heart to Yours üíî</h2>
            </div>
            <div class="message-body">
                <p>
                    I wonder if you think 'what if it could have worked out like I do'
                </p>
                <p>
                    Do you miss what we had? Do you miss us?
                </p>
                <p>
                    I know I messed up. Cool who doesn't at times but trust me I know why. Nita admit vizuri One day trust. But trust I've always been into you
                </p>
                <p>
                    Nothing is a coincidence. From the start us meeting to... it was all there I hear you say I ain't ur type
                </p>
                <p>
                    Cool and all but know this If its nothing you see I cant change or be its e8it for you to act the way you do
                </p>
                <p>
                    Not a quitter though. I'll wait. I gotta million reasons why we are the perfect match. I saw that when I saw you helping those kids
                </p>
                <p>
                    I'm already dead over you for that uniqueness. I'll collapse each day in my thoughts if I lose you. Just know that.
                </p>
                <p>
                    I promise you I will give it my all. I take mine every seriously and I know you do too. I can see that
                </p>
                <p>
                    And I can't stop hoping that maybe, just maybe, there's still a chance for us.
                </p>
                <p>
                    <strong>I need you</strong>
                </p>
                
                <p>
                    I'm not asking for an answer right now. I'm just asking you to know although you know I'm cracked might collapse anytime take your time but you knowüëæ
                </p>
                <p>
                    Also we all got a free mind you know. But rarely does anything we think of happens. We hope. I heard you the first time not with me. But just what if? we can be friends I really dont mind.
                </p>
                <strong>I still got a million thimgs I wanna tell and experience with you.</strong>
                <p>But its really your choice if we wanna date. It was never mine
                </p>
                <p>
                    This might be the dumbest things I might have doneüòÇ Go easy on me ok.
                    I was learning from you. I've been striding for to long I thought you might the perfect one.
                </p>
                <strong>But I know you are the one</strong>
                <p>
                    Na tafathali hii si group project.
                </p>
            </div>
        </div>
    </div>

    <script>
        let currentAudio = null;
        let currentPlayingElement = null;

        // Create falling tears
        function createTear() {
            const tear = document.createElement('div');
            tear.className = 'tear';
            tear.innerHTML = 'üíß';
            tear.style.left = Math.random() * 100 + '%';
            tear.style.animationDuration = (Math.random() * 2 + 2) + 's';
            document.body.appendChild(tear);
            
            setTimeout(() => {
                if (tear.parentNode) {
                    tear.remove();
                }
            }, 4000);
        }

        // Create tears periodically
        setInterval(createTear, 800);

        // Go back to landing page
        function goBack() {
            stopAllAudio();
            window.location.href = 'index.html';
        }

        // Show message modal
        function showMessage() {
            document.getElementById('messageModal').style.display = 'flex';
        }

        // Hide message modal
        function hideMessage() {
            document.getElementById('messageModal').style.display = 'none';
        }

        // Show placeholder if image fails to load
        function showPlaceholder(num) {
            const frame = document.getElementById(`imageFrame${num}`);
            const img = frame.querySelector('img');
            const placeholder = frame.querySelector('.placeholder');
            
            if (img) img.style.display = 'none';
            if (placeholder) placeholder.style.display = 'flex';
        }

        // Stop all audio
        function stopAllAudio() {
            if (currentAudio) {
                currentAudio.pause();
                currentAudio.currentTime = 0;
            }
            
            // Reset all visual states
            document.querySelectorAll('.music-chaos').forEach(btn => {
                btn.classList.remove('playing');
            });
            
            const mainHeart = document.getElementById('mainHeart');
            mainHeart.classList.remove('playing');
            
            hideAudioStatus();
            currentAudio = null;
            currentPlayingElement = null;
        }

        // Show audio status
        function showAudioStatus(message) {
            const status = document.getElementById('audioStatus');
            status.textContent = message;
            status.classList.add('show');
        }

        // Hide audio status
        function hideAudioStatus() {
            const status = document.getElementById('audioStatus');
            status.classList.remove('show');
        }

        // Play audio with fallback
        function playAudioWithFallback(audioElement, title, visualElement) {
            stopAllAudio();
            
            currentAudio = audioElement;
            currentPlayingElement = visualElement;
            
            // Add visual feedback
            if (visualElement) {
                visualElement.classList.add('playing');
            }
            
            showAudioStatus(`üéµ ${title}`);
            
            // Try to play the audio
            const playPromise = audioElement.play();
            
            if (playPromise !== undefined) {
                playPromise.then(() => {
                    // Audio started successfully
                    console.log('Audio playing:', title);
                }).catch(error => {
                    console.log('Audio play failed, using Web Audio API fallback');
                    playToneSequence(title, visualElement);
                });
            }
            
            // Handle audio end
            audioElement.onended = () => {
                if (visualElement) {
                    visualElement.classList.remove('playing');
                }
                hideAudioStatus();
                currentAudio = null;
                currentPlayingElement = null;
            };
        }

        // Fallback: Create audio tones using Web Audio API
        function playToneSequence(title, visualElement) {
            try {
                const audioContext = new (window.AudioContext || window.webkitAudioContext)();
                const oscillator = audioContext.createOscillator();
                const gainNode = audioContext.createGain();
                
                oscillator.connect(gainNode);
                gainNode.connect(audioContext.destination);
                
                // Create a melancholic tone sequence
                const frequencies = [220, 196, 174, 155, 138]; // A3 to C#3 - sad descending
                let currentFreq = 0;
                
                oscillator.type = 'sine';
                oscillator.frequency.setValueAtTime(frequencies[0], audioContext.currentTime);
                
                gainNode.gain.setValueAtTime(0, audioContext.currentTime);
                gainNode.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.1);
                
                // Change frequency every 0.5 seconds
                const interval = setInterval(() => {
                    currentFreq++;
                    if (currentFreq < frequencies.length) {
                        oscillator.frequency.setValueAtTime(frequencies[currentFreq], audioContext.currentTime);
                    } else {
                        clearInterval(interval);
                        gainNode.gain.exponentialRampToValueAtTime(0.001, audioContext.currentTime + 0.5);
                        setTimeout(() => {
                            oscillator.stop();
                            if (visualElement) {
                                visualElement.classList.remove('playing');
                            }
                            hideAudioStatus();
                        }, 500);
                    }
                }, 500);
                
                oscillator.start();
                
            } catch (error) {
                console.log('Web Audio API failed, showing message only');
                setTimeout(() => {
                    if (visualElement) {
                        visualElement.classList.remove('playing');
                    }
                    hideAudioStatus();
                }, 2000);
            }
        }

        // Music functionality
        function playMusic(num) {
            const audioElement = document.getElementById(`musicAudio${num}`);
            const buttonElement = document.getElementById(`musicBtn${num}`);
            const titles = [
                "TRAUMA - PARTYNEXTDOOR",
                "Fix You - Coldplay", 
                "The Night We Met - Lord Huron",
                "Say Something - A Great Big World"
            ];
            
            playAudioWithFallback(audioElement, titles[num - 1], buttonElement);
            
            // Create explosion effect
            createMusicExplosion(buttonElement);
        }

        // Main heart music
        function playMainMusic() {
            const audioElement = document.getElementById('mainHeartAudio');
            const heartElement = document.getElementById('mainHeart');
            
            playAudioWithFallback(audioElement, "Missing You - Heartbreak Symphony", heartElement);
            
            // Create explosion of broken hearts
            createHeartExplosion();
        }

        // Create heart explosion effect
        function createHeartExplosion() {
            for (let i = 0; i < 10; i++) {
                setTimeout(() => {
                    const heart = document.createElement('div');
                    heart.innerHTML = 'üíî';
                    heart.style.position = 'absolute';
                    heart.style.left = '50%';
                    heart.style.top = '50%';
                    heart.style.fontSize = '3rem';
                    heart.style.zIndex = '15';
                    heart.style.pointerEvents = 'none';
                    heart.style.color = '#ff1744';
                    heart.style.filter = 'drop-shadow(0 0 20px rgba(255, 23, 68, 0.8))';
                    
                    const angle = (360 / 10) * i;
                    const distance = 200 + Math.random() * 100;
                    const radians = angle * Math.PI / 180;
                    
                    heart.style.animation = `explodeHeart${i} 2s ease-out forwards`;
                    
                    // Create unique explosion animation
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes explodeHeart${i} {
                            0% {
                                transform: translate(-50%, -50%) rotate(0deg) scale(1);
                                opacity: 1;
                            }
                            100% {
                                transform: translate(-50%, -50%) 
                                           translate(${Math.cos(radians) * distance}px, 
                                                    ${Math.sin(radians) * distance}px) 
                                           rotate(720deg) scale(0);
                                opacity: 0;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    document.body.appendChild(heart);
                    
                    setTimeout(() => {
                        if (heart.parentNode) {
                            heart.remove();
                        }
                        if (style.parentNode) {
                            style.remove();
                        }
                    }, 2000);
                }, i * 100);
            }
        }

        // Create music explosion effect
        function createMusicExplosion(element) {
            const rect = element.getBoundingClientRect();
            const centerX = rect.left + rect.width / 2;
            const centerY = rect.top + rect.height / 2;
            
            for (let i = 0; i < 5; i++) {
                setTimeout(() => {
                    const note = document.createElement('div');
                    const notes = ['üéµ', 'üé∂', 'üéº', 'üé§', 'üéß'];
                    note.innerHTML = notes[Math.floor(Math.random() * notes.length)];
                    note.style.position = 'fixed';
                    note.style.left = centerX + 'px';
                    note.style.top = centerY + 'px';
                    note.style.fontSize = '2rem';
                    note.style.zIndex = '15';
                    note.style.pointerEvents = 'none';
                    note.style.color = '#ff1744';
                    
                    const angle = Math.random() * 360;
                    const distance = 100 + Math.random() * 50;
                    const radians = angle * Math.PI / 180;
                    
                    note.style.animation = `explodeNote${i}-${Date.now()} 1.5s ease-out forwards`;
                    
                    const style = document.createElement('style');
                    style.textContent = `
                        @keyframes explodeNote${i}-${Date.now()} {
                            0% {
                                transform: translate(-50%, -50%) scale(1);
                                opacity: 1;
                            }
                            100% {
                                transform: translate(-50%, -50%) 
                                           translate(${Math.cos(radians) * distance}px, 
                                                    ${Math.sin(radians) * distance}px) 
                                           scale(0);
                                opacity: 0;
                            }
                        }
                    `;
                    document.head.appendChild(style);
                    
                    document.body.appendChild(note);
                    
                    setTimeout(() => {
                        if (note.parentNode) {
                            note.remove();
                        }
                        if (style.parentNode) {
                            style.remove();
                        }
                    }, 1500);
                }, i * 150);
            }
        }

        // Random glitch effects
        setInterval(() => {
            const elements = document.querySelectorAll('.chaos-text, .image-frame');
            const randomElement = elements[Math.floor(Math.random() * elements.length)];
            randomElement.classList.add('glitch');
            
            setTimeout(() => {
                randomElement.classList.remove('glitch');
            }, 1000);
        }, 3000);

        // Initialize audio elements
        document.addEventListener('DOMContentLoaded', function() {
            // Set volume for all audio elements
            const audioElements = document.querySelectorAll('audio');
            audioElements.forEach(audio => {
                audio.volume = 0.3; // Set to 30% volume
                audio.loop = false;
            });
        });

        // Close message modal when clicking outside
        document.getElementById('messageModal').addEventListener('click', function(e) {
            if (e.target === this) {
                hideMessage();
            }
        });

        // Keyboard shortcuts
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                hideMessage();
            }
            if (e.key === 'm' || e.key === 'M') {
                showMessage();
            }
        });
    </script>
</body>
</html>